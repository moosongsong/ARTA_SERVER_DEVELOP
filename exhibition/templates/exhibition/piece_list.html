{% extends 'exhibition/ARTA_header.html' %}
{% load static %}
{% block header_title %}<title>전시회 보기</title>{% endblock %}

{% block script_blcok %}
    <script type="text/javascript">
        $(document).ready(function () {

            $(window).scroll(function () {

                $('.piece_action').each(function (i) {
                    var bottom_of_object = $(this).offset().top + $(this).outerHeight();
                    var top_of_object = $(this).offset().top;
                    var middle_of_window = $(window).scrollTop() + $(window).height() / 2;
                    var windowWidth = $(window).width();

                    if (windowWidth < 992 && middle_of_window > top_of_object && middle_of_window < bottom_of_object) {
                        //$(this).animate({'opacity':'1','margin-left':'0px'},500);
                        if ($(this).css("opacity") == 0) {
                            $(this).fadeTo(500, 1);
                        }
                    } else { //object goes out of view (scrolling up)
                        if ($(this).css("opacity") == 1) {
                            $(this).fadeTo(500, 0);
                        }
                    }

                });
            });
        });
    </script>
{% endblock %}
{% block style_blcok %}
    <link rel="stylesheet" href="{% static 'exhibition/css/exhibition_show_style.css' %}"/>
    <link rel="stylesheet" href="{% static 'exhibition/css/main.css' %}"/>
    <link rel="stylesheet" href="{% static 'exhibition/css/pagination.css' %}"/>
{% endblock %}
{% block main_blcok %}
    <div class="row">
        <div class="aside_container col-md-1 col-md-push-11">
            <p class="main_name"> 전시회 페이지</p>
            <div class="icon row">
                <!--share icon-->
                <a class="share" id="btnKakao" href="javascript:shareKakao();">
                    <i class="fa fa-share-alt" style="font-size:13px" aria-hidden="true"></i>
                    <p class="icon_font"> 공유 </p>
                </a>
                <!--like icon-->
                <a class="bookmark" href="{{ exhibition.get_absolute_url }}new_like/">
                    <i class="fa fa-heart" style="font-size:13px" aria-hidden="true"></i>
                    <p class="icon_font"> 좋아요 </p>
                </a>
                {#                    <a class="bookmark" href="{{ exhibition.get_absolute_url }}dislike/">#}
                {#                        <i class="fa fa-heart" style="font-size:13px" aria-hidden="true"></i>#}
                {#                        <p class="icon_font"> 좋아요 취소 </p>#}
                {#                    </a>#}
                <!--guestbook icon-->
                <a class="guest_book" href="#open">
                    <i class="fa fa-comment-alt" style="font-size:13px" aria-hidden="true"></i>
                    <p class="icon_font"> 방명록 </p>

                    <div class="modal-hidden" id="open">
                        <div class="modal-Box">
                            <p class="modal-name">전시회 방명록</p>
                            <a href="#close" class="modal-close"><i class="fas fa-times"></i></a>

                            <!--guestbook list-->
                            <div class="comments">
                                <!--guestbook insert form-->
                                {% if user.is_authenticated %}
                                    <form id="comment-form" method="post"
                                          action="{{ exhibition.get_absolute_url }}new_guestbook/">
                                        {% csrf_token %}
                                        <div class="input-comment">
                                            <label for="new_comment"></label>
                                            <textarea class="form-control" id="new_comment" name="content" rows="3"
                                                      placeholder="방명록을 입력해주세요"></textarea>
                                            <button class="submit_btn" type="submit" onclick="submitComment()">OK!
                                            </button>
                                        </div>
                                    </form>
                                {% else %}
                                    <div class="input-comment">
                                        <p>로그인을 하셔야 방명록을 남길 수 있습니다.</p>
                                    </div>
                                {% endif %}

                                {% if messages %}
                                    {% for message in messages %}
                                        <p>{{ message }}</p>
                                        <p></p>
                                    {% endfor %}
                                {% endif %}

                                <!--guest book loop-->
                                {% if exhibition.guestbook_set.exists %}
                                    {% for guestbook in exhibition.guestbook_set.iterator %}
                                        <div class="comment-row">
                                            <div class="store-comment">
                                                <div class="comment-id">
                                                    <strong>{{ guestbook.user.username }}</strong>
                                                </div>
                                                <div class="comment-date">{{ guestbook.create_at }}</div>
                                                {% if guestbook.user == user and user.is_authenticated %}
                                                    <a href="/exhibition/delete_guestbook/{{ guestbook.pk }}">
                                                        <button class="cancel-button"><i class="fas fa-times"></i>
                                                        </button>
                                                    </a>
                                                {% endif %}
                                            </div>
                                            <div class="comment-content">{{ guestbook.content }}</div>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <p>아직 작성된 방명록이 없습니다! 당신이 첫번째 방명록을 달아주세여</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        <div class="content_container col-md-11 col-md-pull-1">
            <!--exhibition-->
            <div class="article_container">
                <div class="exhibition_poster">
                    <img class="exhibition_img" src="{{ exhibition.poster.url }}" alt="포스터가 등록되지 않았습니다."/>
                    <div class="exhibition_info">
                        <p class="exhibit_day">{{ exhibition.start_at.date }} ~ {{ exhibition.end_at.date }}</p>
                        <p class="exhibitor"><strong>{{ exhibition.user.username }}</strong></p>
                        <p class="exhibition_name"><strong>{{ exhibition.name }}</strong></p>
                    </div>
                </div>
                <div class="exhibition_main">
                    <div class="exhibition_p">
                        <p>{{ exhibition.explain }}</p>
                    </div>
                    <!--piece liest-->
                    <div class="piece_container">
                        <!--piece loop-->
                        {% if piece_list %}
                            {% for piece in piece_list %}
                                <!--piece-->
                                <div class="piece_img_block">
                                    <a href="{{ piece.get_absolute_url }}" class="img_block">
                                        <img class="piece_img" src="{{ piece.image.url }}" alt="그림이 서버에서 사라짐...ㅠㅠ"/>
                                        <div class="piece_action">
                                            <p>{{ piece.author }}</p>
                                        </div>
                                    </a>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p>아직 등록된 그림이 없습니다. 조금만 기다려~</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="footer_row col-xs-12"> <!--아래 페이징 공간-->
            <footer>
                {% if is_paginated %}
                    <ul class="pagination pagination-sm">
                        {% if page_obj.has_next %}
                            {% if page_obj.has_previous %}
                                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">
                                    <i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                    <i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                            {% else %}
                                <li class="page-item"><a class="page-fake disabled" href="">
                                    <i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                    <i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                            {% endif %}
                        {% else %}
                            {% if page_obj.has_previous %}
                                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">
                                    <i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake disabled" href="">
                                    <i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                            {% else %}
                                <li class="page-item"><a class="page-fake disabled" href="">
                                    <i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake disabled" href="">
                                    <i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                            {% endif %}
                        {% endif %}
                    </ul>
                {% endif %}
            </footer>
        </div>
    </div>
{% endblock %}